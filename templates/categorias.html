{% extends "base.html" %}

{% block title %}Categorías - Inventario App{% endblock %}

{% block content %}
<!-- Header -->
<div class="row mb-4">
    <div class="col-md-6">
        <h1 class="display-5">
            <i class="bi bi-folder"></i> Categorías
        </h1>
        <p class="text-muted-custom">Organiza tus productos por categorías</p>
    </div>
    <div class="col-md-6 text-end">
        <a href="{{ url_for('nueva_categoria') }}" class="btn btn-primary-custom btn-lg">
            <i class="bi bi-plus-circle"></i> Nueva Categoría
        </a>
    </div>
</div>

<!-- Tarjetas de Categorías -->
<div class="row">
    {% if categorias %}
        {% for categoria in categorias %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card card-custom h-100 shadow-custom">
                <div class="card-header card-header-custom">
                    <i class="bi bi-folder-fill"></i> {{ categoria.nombre }}
                    <span class="badge bg-light text-dark float-end">
                        {{ categoria.total_productos }} producto(s)
                    </span>
                </div>
                <div class="card-body">
                    {% if categoria.descripcion %}
                        <p class="card-text text-muted-custom">{{ categoria.descripcion }}</p>
                    {% else %}
                        <p class="card-text text-muted-custom fst-italic">Sin descripción</p>
                    {% endif %}

                    <!-- Información adicional -->
                    <hr>
                    <small class="text-muted-custom">
                        <i class="bi bi-calendar"></i>
                        Creada: {{ categoria.created_at[:10] if categoria.created_at else 'N/A' }}
                    </small>
                </div>
                <div class="card-footer bg-transparent border-top-0">
                    <div class="d-flex justify-content-end gap-2">
                        <a href="{{ url_for('editar_categoria', id=categoria.id) }}"
                           class="btn btn-sm btn-outline-primary"
                           title="Editar">
                            <i class="bi bi-pencil"></i> Editar
                        </a>
                        <button type="button"
                                class="btn btn-sm btn-outline-danger"
                                onclick="confirmarEliminar({{ categoria.id }}, '{{ categoria.nombre }}', {{ categoria.total_productos }})"
                                title="Eliminar">
                            <i class="bi bi-trash"></i> Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="col-md-12">
            <div class="card card-custom">
                <div class="card-body text-center py-5">
                    <i class="bi bi-folder-x fs-1 text-muted-custom"></i>
                    <h4 class="mt-3 text-muted-custom">No hay categorías registradas</h4>
                    <p class="text-muted-custom">Comienza creando tu primera categoría para organizar los productos</p>
                    <a href="{{ url_for('nueva_categoria') }}" class="btn btn-primary-custom mt-3">
                        <i class="bi bi-plus-circle"></i> Crear Categoría
                    </a>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<!-- Formulario oculto para eliminar -->
<form id="deleteForm" method="POST" style="display: none;">
</form>

{% endblock %}

{% block extra_js %}
<script>
function confirmarEliminar(id, nombre, totalProductos) {
    let mensaje = `¿Estás seguro de eliminar la categoría "${nombre}"?`;

    if (totalProductos > 0) {
        mensaje = `La categoría "${nombre}" tiene ${totalProductos} producto(s) asociado(s). No podrás eliminarla hasta reasignar o eliminar esos productos.\n\n¿Intentar eliminar de todos modos?`;
    }

    if (confirm(mensaje)) {
        const form = document.getElementById('deleteForm');
        form.action = `/categoria/${id}/eliminar`;
        form.submit();
    }
}
</script>
{% endblock %}
